<% if flash[:notice]%>
  <div class="big-message success">
    <h2><%= flash[:notice] %></h2>
    <div class="bg"></div>
    <div class="close"></div>
  </div>
<% end %>

<div class="block">
  <div class="top">
    <h2><%= t('Show my open ') + ' ' + Basket.human_name %></h2>
  </div>
  <div class="content">
    <h1><%= image_tag(@shop_cart, :border=>0, :alt =>'shopping cart') %> <%= t('shopping cart for ') %>  
      <% if current_user %>
        <b><%= @basket.customer.title + ' ' + @basket.customer.firstname  + ' ' + @basket.customer.lastname %></b>
      <% end %>
    </h1>
    <table class="listing">
      <thead>
        <tr>
          <th colspan="2"><%= t('article in the shopping cart') %></th>
          <th><%= Product.human_attribute_name('quantity') %></th>
          <th><%= Product.human_attribute_name('price') %></th>
          <th></th>
        </tr>
      </thead>

      <% @basket.basketlines.each do |b| %>
        <tr class="<%= cycle('', 'even') %>">
          <% anzahl = 0 %>
          <% b.product.assets.each do |asset| %>
            <% anzahl += 1 %>
            <% if anzahl < 2 %>
              <td width="5%"><%= link_to (image_tag (asset.image.url(:small)),  html_options = {:style => "vertical-align:middle"}), :controller => 'products', :action => 'product_detail', :id => b.product.id %></td>
            <% end %>
          <% end %>

          <td><%= b.product.shorttext %></td>
          <td>
            <%= form_for b, :url => {:controller => 'baskets', :action => 'add_to_basket', :id => b.product.id} do |p| %>
            <%= number_field(:basketline, :quantity, options = {:size => 5, :value => b.quantity, :min => '0', :max => '99', :class => "basket_input"})%></td>
            <%= p.hidden_field(:product_id, :value => b.product.id)%>
            <%= p.hidden_field(:mode, :value => 'basket')%>
          </td>
          <td align="center"><%= number_to_currency(b.price) %></td>
          <td><%= image_submit_tag("edit.png") %></td>
          <% end %>
        </tr>
      <% end %>
      <tfoot>
        <tr class = "linemain">
          <th colspan="3"></th>
          <th align="right"><%= number_to_currency(@basket.basketlines.sum(:value)) %></th>
          <th></th>
        </tr>
      </tfoot>
    </table>
  </div>
</div>